<!--
 * @Description: 
 * @Version: 1.0
 * @Author: DaLao
 * @Email: dalao_li@163.com
 * @Date: 2021-12-31 12:44:48
 * @LastEditors: DaLao
 * @LastEditTime: 2022-01-26 22:21:59
-->

{% extends "layout.html" %}

{% block title %}导入数据{% endblock %}

{% block content %}

<div class="container">
    {% if status == 1%}
    <div class="alert alert-success alert-dismissible">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <strong>上传成功!</strong>
    </div>
    {% endif %}
    <div class="alert alert-danger alert-dismissible">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <strong>注意!</strong>新上传的文件会覆盖之前的数据
    </div>

    <form action="/data" method="POST" enctype="multipart/form-data" onsubmit="return upload()">
        <div class="input-group mb-3">
            <span class="input-group-text">仅限Excel</span>
            <input id="file" class="btn btn-info" name="file" type="file" />
            <input type="submit" class="btn btn-success" value="提交"></input>
        </div>
    </form>

    <div>
        <table class="table table-hover" id="infoTable">
            <thead>
                <tr>
                    <th>序号</th>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>工作单位</th>
                    <th>类别</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for i in data %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ i.name }}</td>
                    <td>{{ i.sex }}</td>
                    <td>{{ i.department }}</td>
                    <td>{{ i.identify }}</td>
                    <td><button type="button" class="btn btn-primary" id="{{ i.id }}" onclick=get()>查看</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</body>

<script src="{{ url_for('static',filename='bootstrap-table-zh-CN.min.js') }}"></script>
<script>
    function get() {
        $.get('/get/people/' + event.target.id, function (data) {
            alert(data)
        })
    }

    function upload() {
        const f = document.getElementById("file").files[0]
        if (!f) {
            alert("请选择上传文件")
            return false
        }
        const format = f.name.split('.')[1]
        if (format != 'xlsx' && format != 'xls') {
            alert("上传文件不是Excel文件!请重试")
            return false
        }
        return true
    }


    $('#infoTable').bootstrapTable({
        // 是否显示分页条
        pagination: true,
        // 首页页码
        pageNumber: 1,
        // 一页显示的行数
        pageSize: 10,
        // 是否开启分页条无限循环，最后一页时点击下一页是否转到第一页
        paginationLoop: false,
        // 选择每页显示多少行，数据过少时可能会没有效果
        pageList: [10, 25, 50],
        // 启用关键字搜索框
        search: true,
    })
</script>

{% endblock %}